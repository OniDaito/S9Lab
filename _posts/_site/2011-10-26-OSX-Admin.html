<p>At one of my jobs, I&#8217;ve been thrown into the deep end when it comes to sysadmin. I&#8217;ve always done this a little but largely on a Linux based platform. As I&#8217;m involved with an Arts University, most of the machines here are Apple based. It&#8217;s a little bit different in certain cases and there are some fun things already installed. The first is the <em>screen sharing</em> app.</p>

<pre><code>/System/Library/CoreServices/Screen Sharing.app</code></pre>

<p>This program is quite useful - it&#8217;s a great way for doing remote admin. In addition, if another user is logged in <em>you get to see what they are doing</em> - It&#8217;s genius and also a little scary.</p>

<p>Sometimes its not setup remotely. This will do that for you:</p>

<pre><code>sudo sh -c &quot;/bin/echo -n enabled &gt; 
/Library/Preferences/com.apple.ScreenSharing.launchd&quot;</code></pre>

<p>So being a Linux guy mostly, I aim for the command line. I have almost 100 Apple iMacs at my command so of course, I got to it. Firstly, SSH keys for password-less login were needed. That means:</p>

<ol>
<li>create the .ssh directory</li>

<li>create authorized_hosts within the .ssh dir</li>

<li>copy over the contents of your own id_rsa.pub</li>
</ol>

<p>This took quite a while as you can imagine. But even before this, I had no idea of the IP addresses for the machines. There is no internal DNS or anthing so out comes out <em>nmap</em></p>

<pre><code>nmap -oX results.xml -sn -n 10.130.144.0/24</code></pre>

<p>I love nmap and I need to learn how to use it better. This produces an XML list of the machines that are currently running. Sadly, I could not figure out how to return <em>just</em> the iMacs so there are some Windows XP machines and routers in there too.</p>

<p>Of course, XML is not so bash friendly (unless you know of cool XML parsing in bash - hit me up if you do). This is where Python comes in:</p>

<pre><code>from lxml import etree
f = open(args.iplist,&#39;r&#39;)
xml = f.read()
f.close()
root = etree.fromstring(xml)
for element in root.iter():
    if element.tag.__str__() == &#39;address&#39;:</code></pre>

<p><em>subprocess</em> is still a bit of a dark art to me. The <em>shell=True</em> bit is quite important as it opens a remote shell. Also the <em>-t</em> argument to ssh helps.</p>

<p>The beauty of OSX is that there are command line versions of various GUI programmers such as:</p>

<pre><code>sudo installer -pkg /Volumes/Google\ SketchUp\ 8.0\ 
\(English\)/Google\ SketchUp\ 8.0\ Installer.mpkg -target</code></pre>

<p>This allows you to install things inside an mpkg. Very handy. Mounting DMG files is also easy with:</p>

<pre><code>hdid</code></pre>

<p>Unmounting, you can use:</p>

<pre><code>umount</code></pre>

<p>Just as you would on the <em>nix</em></p>

<p>The problem with using <em>sudo</em> a lot is that we need to keep typing passwords all the time. You can use the following <em>ENV</em> variable to launch a window in OSX to type this in:</p>

<pre><code>env = {&#39;SSH_ASKPASS&#39;:&#39;/Users/oni/Projects/Scripts/ssh-askpass&#39;, 
&#39;DISPLAY&#39;:&#39;0&#39;, &#39;SUDO_ASKPASS&#39;:&#39;/Users/oni/Projects/Scripts/ssh-askpass&#39;}</code></pre>

<p>askpass is a bash program that looks like this:</p>

<pre><code>#! /bin/sh  
#
# An SSH_ASKPASS command for MacOS X 
#
# Author: Joseph Mocker, Sun Microsystems  

#
# To use this script:
#     setenv SSH_ASKPASS &quot;macos-askpass&quot;
#     setenv DISPLAY &quot;:0&quot;
#  
TITLE=${MACOS_ASKPASS_TITLE:-&quot;SSH&quot;}  
DIALOG=&quot;display dialog \&quot;$@\&quot; default answer \&quot;\&quot; with title \&quot;$TITLE\&quot;&quot;
DIALOG=&quot;$DIALOG with icon caution with hidden answer&quot;  
result=`osascript -e &#39;tell application &quot;Finder&quot;&#39; -e &quot;activate&quot;  -e &quot;$DIALOG&quot; -e &#39;end tell&#39;`  
if [ &quot;$result&quot; = &quot;&quot; ]; then
    exit 1
else
    echo &quot;$result&quot; | sed -e &#39;s/^text returned://&#39; -e &#39;s/, button returned:.*$//&#39;
    exit 0
fi  </code></pre>

<p>Notice the handy <em>osascript -e</em> command. Thats pretty handy as well.</p>

<p>I believe there is a python library for doing simultaneous installs as well called <a href='http://docs.fabfile.org/en/1.3.1/index.html'>Fabric</a> that I reckon will make this go uber-smooth in the future!</p>

<p>Finally, to remove password entru for sudo, use:</p>

<pre><code>sudo visudo</code></pre>

<p>adding the following line:</p>

<pre><code>&lt;username&gt;  ALL=NOPASSWD: ALL</code></pre>

<p>replacing <pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;username&gt; with the user you are using to do all the installs. So far, Im getting there. I will have many devices under my command! It was grossly inefficent but a good way to learn a great many things. Remember the process is what counts people!</pre></p>