<!DOCTYPE html>
<!--
                      __  .__              ________ 
  ______ ____   _____/  |_|__| ____   ____/   __   \
 /  ___// __ \_/ ___\   __\  |/  _ \ /    \____    /
 \___ \\  ___/\  \___|  | |  (  <_> )   |  \ /    / 
/____  >\___  >\___  >__| |__|\____/|___|  //____/ .co.uk 
     \/     \/     \/                    \/        
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>OSX Admin for the lulz</title>
  <meta name="author" content="Benjamin Blundell" />
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Section9 ATOM Feed">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <link href="/css/bootstrap.css" rel="stylesheet">
  <link href="/css/bootstrap-responsive.css" rel="stylesheet">
  <link href="/css/s9.css" rel="stylesheet" media="screen">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/s9-144.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/s9-114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/s9-72.png">
  <link rel="apple-touch-icon-precomposed" href="/images/s9-57.png">
  <link rel="shortcut icon" href="/images/favicon.ico">

  <!-- META DATA - Need to Check and Update -->
  <meta name="google-site-verification" content="Ew7bGq_-B5Djz3nNvxYt6abpW2fUBOU-rFKrlvIQwiU" /> 

  <!-- General metadata -->
  <meta name="generator" content="" />
  <meta name="robots" content="index,follow" />
  <meta name="revisit-after" content="2 days" />
  <meta name="Author-Template" content="" />
  <meta name="Author" content="Benjamin Blundell" />
  <meta name="Publisher" content="Benjamin Blundell" />
  <meta name="Publisher-Email" content="oni@section9.co.uk" />
  <meta name="Coverage" content="UK" /> 

  <!-- Dublin Core Metadata -->
  <meta name="DC.creator" lang="en" content="Benjamin Blundell" />
  <meta name="DC.date.created" lang="en" content="" />
  <meta name="DC.format" lang="en" content="text/html" />
  <meta name="DC.language" content="en" />
  <meta name="DC.publisher" lang="en" content="Benjamin Blundell" />
  <meta name="DC.rights.copyright" lang="en" content="Benjamin Blundell" />
  <meta name="DC.coverage" lang="en" content="" />
  <meta name="DC.identifier" content="" />    
  
  <!-- eGMS Metadata -->
  <meta name="eGMS.status" lang="en" content="V1.0 Public Consumption" />
  
  <meta name="Keywords" content="creative technologist,webgl, coffeescript, git, kinect,opengl,cinder,openframeworks,cpp,c++,programming,graphics,art,design,code" />
  <meta name="Description" content="Benjamin Blundell, section9 dot co dot uk ltd, the home of Benjamin Blundell. I create with WebGL, Nodejs, Javascript, C++, OpenFrameworks and Cinder amongst many other things." />
  <meta name="DC.title" lang="en" content="section9 dot co dot uk ltd - Home of Creative Technologist Benjamin Blundell" />
  <meta name="DC.description" lang="en" content="" />
  <meta name="DC.subject" lang="en" content="" /> 

  <script src="/js/jquery-1.8.3.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>

</head>

<body>
<div class="navbar navbar-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="brand" href="http://www.section9.co.uk"><img class="brand" src = "/images/s9black.png" alt="section9 dot co dot uk ltd" /></a>
      <a class="brand" href="http://www.section9.co.uk" id="companyname">section9 dot co dot uk</a>

      <div class="nav-collapse collapse">
        <ul class="nav">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/contact.html">Contact</a></li>
          <li><a href="/blog.html">Blog</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<hr />

<div class="container-fluid" id="content">
  <div id="blogblocks">
    
<p>At one of my jobs, I've been thrown into the deep end when it comes to sysadmin. I've always done this a little but largely on a Linux based platform. As I'm involved with an Arts University, most of the machines here are Apple based. It's a little bit different in certain cases and there are some fun things already installed. The first is the <em>screen sharing</em> app.</p>
<pre><code>/System/Library/CoreServices/Screen Sharing.app
</code></pre>
<p>This program is quite useful - it's a great way for doing remote admin. In addition, if another user is logged in <em>you get to see what they are doing</em> - It's genius and also a little scary.</p>
<p>Sometimes its not setup remotely. This will do that for you:</p>
<pre><code>sudo sh -c "/bin/echo -n enabled &gt; 
/Library/Preferences/com.apple.ScreenSharing.launchd"
</code></pre>
<p>So being a Linux guy mostly, I aim for the command line. I have almost 100 Apple iMacs at my command so of course, I got to it. Firstly, SSH keys for password-less login were needed. That means:</p>
<ol>
<li>create the .ssh directory</li>
<li>create authorized_hosts within the .ssh dir</li>
<li>copy over the contents of your own id_rsa.pub</li>
</ol>
<p>This took quite a while as you can imagine. But even before this, I had no idea of the IP addresses for the machines. There is no internal DNS or anthing so out comes out <em>nmap</em></p>
<pre><code>nmap -oX results.xml -sn -n 10.130.144.0/24
</code></pre>
<p>I love nmap and I need to learn how to use it better. This produces an XML list of the machines that are currently running. Sadly, I could not figure out how to return <em>just</em> the iMacs so there are some Windows XP machines and routers in there too.</p>
<p>Of course, XML is not so bash friendly (unless you know of cool XML parsing in bash - hit me up if you do). This is where Python comes in:</p>
<pre><code>from lxml import etree
f = open(args.iplist,'r')
xml = f.read()
f.close()
root = etree.fromstring(xml)
for element in root.iter():
    if element.tag.__str__() == 'address':
</code></pre>
<p><em>subprocess</em> is still a bit of a dark art to me. The <em>shell=True</em> bit is quite important as it opens a remote shell. Also the <em>-t</em> argument to ssh helps.</p>
<p>The beauty of OSX is that there are command line versions of various GUI programmers such as:</p>
<pre><code>sudo installer -pkg /Volumes/Google\ SketchUp\ 8.0\ 
\(English\)/Google\ SketchUp\ 8.0\ Installer.mpkg -target
</code></pre>
<p>This allows you to install things inside an mpkg. Very handy. Mounting DMG files is also easy with:</p>
<pre><code>hdid
</code></pre>
<p>Unmounting, you can use:</p>
<pre><code>umount
</code></pre>
<p>Just as you would on the <em>nix</em></p>
<p>The problem with using <em>sudo</em> a lot is that we need to keep typing passwords all the time. You can use the following <em>ENV</em> variable to launch a window in OSX to type this in:</p>
<pre><code>env = {'SSH_ASKPASS':'/Users/oni/Projects/Scripts/ssh-askpass', 
'DISPLAY':'0', 'SUDO_ASKPASS':'/Users/oni/Projects/Scripts/ssh-askpass'}
</code></pre>
<p>askpass is a bash program that looks like this:</p>
<pre><code>! /bin/sh

 An SSH_ASKPASS command for MacOS X

 Author: Joseph Mocker, Sun Microsystems


 To use this script:
     setenv SSH_ASKPASS "macos-askpass"
     setenv DISPLAY ":0"

TITLE=${MACOS_ASKPASS_TITLE:-"SSH"}  
DIALOG="display dialog \"$@\" default answer \"\" with title \"$TITLE\""
DIALOG="$DIALOG with icon caution with hidden answer"  
result=`osascript -e 'tell application "Finder"' -e "activate"  -e "$DIALOG" -e 'end tell'`  
if [ "$result" = "" ]; then
    exit 1
else
    echo "$result" | sed -e 's/^text returned://' -e 's/, button returned:.*$//'
    exit 0
fi
</code></pre>
<p>Notice the handy <em>osascript -e</em> command. Thats pretty handy as well.</p>
<p>I believe there is a python library for doing simultaneous installs as well called <a href="http://docs.fabfile.org/en/1.3.1/index.html">Fabric</a> that I reckon will make this go uber-smooth in the future!</p>
<p>Finally, to remove password entru for sudo, use:</p>
<pre><code>sudo visudo
</code></pre>
<p>adding the following line:</p>
<pre><code>&lt;username&gt;  ALL=NOPASSWD: ALL
</code></pre>
<p>replacing <username> with the user you are using to do all the installs. So far, Im getting there. I will have many devices under my command! It was grossly inefficent but a good way to learn a great many things. Remember the process is what counts people!</p>

  </div>

  <hr />
  <footer>
    <p><ul><li>Â© section9 dot co dot uk ltd 2013 - Benjamin Blundell - Registered Company 7794714 - Unit 10 Durham Yard, Teesdale Street, London E2 6QF</li><li> <a href="http://www.section9.co.uk/atom.xml">rss atom feed</a></li><li><a href="http://www.section9.co.uk/key.html">public gnupg key</a></li></p>
  </footer>
</div>



<script type="text/javascript">
  $(window).load(function(){

    // Process p code blocks

    $("#blogblocks p > code").each(function (i,e) {
      $(e).parent().replaceWith(e);
      $(e).wrap("<div class='blogvideo'><div>")
    });


    // Process 'objects' next

    $("#blogblocks p > object").each(function (i,e) {
      $(e).parent().replaceWith(e);
    });
    

    $('#blogblocks p').wrap("<div class='span3 blogblock'></div>");

    var divs = $("#blogblocks .blogblock");
    for(var i = 0; i < divs.length; i+=4) {
      divs.slice(i, i+4).wrapAll("<div class='row-fluid'></div>");
    }

    $('#blogblocks .row-fluid').each (function (i,e) {
     $(e).after('<hr />');
    });

    $("#blogblocks iframe").wrap("<div class='blogvideo'><div>")
    $("#blogblocks object").wrap("<div class='blogvideo'><div>")


    $("#blogblocks .blogvideo").each(function(i,e){
      $(e).after('<hr />');

    });

    // Process all images in the post to add light boxes
    var images = $("#blogblocks img");
    for(var i = 0; i < images.length; i++) {
      $(images[i]).wrap("<a href='" + $(images[i]).attr("src") + "'></a>");
    }

  });

</script>


</body>
</html>

