<!DOCTYPE html>
<!--
                      __  .__              ________ 
  ______ ____   _____/  |_|__| ____   ____/   __   \
 /  ___// __ \_/ ___\   __\  |/  _ \ /    \____    /
 \___ \\  ___/\  \___|  | |  (  <_> )   |  \ /    / 
/____  >\___  >\___  >__| |__|\____/|___|  //____/ .co.uk 
     \/     \/     \/                    \/        
   -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb" class="skrollr skrollr-desktop">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Mosaic</title>
    <meta name="author" content="Benjamin Blundell" />
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Section9 ATOM Feed">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/css/s9.css" rel="stylesheet" media="screen">
    <link href="/css/font-awesome.min.css" rel="stylesheet" media="screen">


    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/s9-144.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/s9-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/s9-72.png">
    <link rel="apple-touch-icon-precomposed" href="/images/s9-57.png">
    <link rel="shortcut icon" href="/images/favicon.ico">

    <!-- META DATA - Need to Check and Update -->
    <meta name="google-site-verification" content="Ew7bGq_-B5Djz3nNvxYt6abpW2fUBOU-rFKrlvIQwiU" /> 

    <!-- General metadata -->
    <meta name="generator" content="" />
    <meta name="robots" content="index,follow" />
    <meta name="revisit-after" content="2 days" />
    <meta name="Author-Template" content="" />
    <meta name="Author" content="Benjamin Blundell" />
    <meta name="Publisher" content="Benjamin Blundell" />
    <meta name="Publisher-Email" content="ben@section9.co.uk" />
    <meta name="Coverage" content="UK" /> 

    <!-- Dublin Core Metadata -->
    <meta name="DC.creator" lang="en" content="Benjamin Blundell" />
    <meta name="DC.date.created" lang="en" content="" />
    <meta name="DC.format" lang="en" content="text/html" />
    <meta name="DC.language" content="en" />
    <meta name="DC.publisher" lang="en" content="Benjamin Blundell" />
    <meta name="DC.rights.copyright" lang="en" content="Benjamin Blundell" />
    <meta name="DC.coverage" lang="en" content="" />
    <meta name="DC.identifier" content="" />    

    <!-- eGMS Metadata -->
    <meta name="eGMS.status" lang="en" content="V1.0 Public Consumption" />

    <meta name="Keywords" content="opengl, webgl, coffeescript, git, hpc, kinect, opengl, cinder,openframeworks, cpp, c++, programming, graphics, art, design, code" />
    <meta name="Description" content="Benjamin Blundell, section9 dot co dot uk, the home of Benjamin Blundell. I make things with computers"/>
    <meta name="DC.title" lang="en" content="section9 dot co dot uk - Benjamin Blundell" />
    <meta name="DC.description" lang="en" content="" />
    <meta name="DC.subject" lang="en" content="" /> 

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/skrollr.min.js"></script>


  </head>

  <body>

    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <img class="navbar-brand-image" src="/images/s9_tiny.png" alt="section9 logo" />

          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/index.html">Benjamin J. Blundell</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li ><a href="/index.html">Home</a></li>
            <li ><a href="/blog.html">Blog</a></li>
            

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">Professional Work <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-12-21-Utopia.html">UTOPIA Bio-informatics Toolkit</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-12-12-Bullseye.html">Bullseye's playground for Target and Psyop</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-09-26-Echo-Forms-Live-Gig.html">Echoforms at Lexus NX Launch</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-09-06-900-Pixel-Screen.html">900 RGB LED Screen</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-07-28-Kaleidoscope.html">Kaleidoscope for Lexus</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-05-28-Equatorie.html">The Equatorie</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-02-13-Phantom-Limb-Oculus.html">Oculus Rift, meet Phantom Limb Therapy</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-08-06-Photorealistic-Hands.html">Photo-realistic hands</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2013-07-12-BurberryKisses.html">Burberry Kisses, with Google and Grow Interactive</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-04-08-Museum-of-Rural-Life.html">Museum of Rural Life Smart Audio Guide</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-02-18-BritishMuseumCoins.html">Coin Detection at the British Museum</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2012-11-19-The-Carp-and-the-Seagull.html">The Carp and the Seagull</a></li>
                
                
                <li class="divider"></li>
                <li><a href="/work.html">...and more!</a></li>

              </ul>
            </li>

            <li class="dropdown">
              <a href="/work.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">Fun Experiments <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">



                <li><a href="#">Asteroids</a></li>
                <li><a href="#">EchoForms</a></li>
                <li><a href="#">Amiga Bouncing Ball</a></li>


              </ul>
            </li>

            <li ><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="jumbotron">
      <div class="container">
        <h2>Mosaic</h2>
        <h3>13-01-2012</h3>
        <p>Using OpenMP and some neat python to show students how to be secure, through intelligent vandalism!</p>
      </div>
    </div>

    <div class ="container" id="content">
      <div class="col-md-9">

        
<p>As is my way, I decided to embark on some intelligent vandalism, only this time, in the digital realm. We have several machines in our lab at Central St Martins and access to these is completely open. There are no student passwords and as such, students here have become lazy and left all their data on the desktop or trash. I decided to write a script to pull off all the data from these machines, find the images and mash them all together in a mosaic. </p>
<p><img alt="Final Attempt" src="http://farm8.staticflickr.com/7159/6679523043_d04379dcd7.jpg" /></p>
<p>At first, I had to grab the images, rename them, resize them and put them in the right sort of place. This is actually a tricky problem because files have spaces, many directory levels and all the rest.</p>
<pre><code>!/bin/bash
c=0
find . -type f -name "*.jpg" -o -name "*.jpeg" 
-o -name "*.JPG" -o -name "*.png" -o -name "*.PNG"
-o -name "*.tif" -o -name "*.tiff" 
-o -name "*.bmp" -o -name "*.BMP" 
-o -name "*.TIFF" -o -name "*.TIF" 
-o -name "*.JPEG" | while read FILE
do
  fn="$(basename "$FILE")"
  echo "$FILE"
  en=${fn*.}
  dn="$(dirname "$FILE")"
  cp -- "$FILE" $1/$c.$en
  convert "$1/$c.$en" -resize 64x64 "$1/$c.jpg"
  let c=c+1
done
</code></pre>
<p>This worked more or less. There are probably improvements we can make to this but for now, I had around 300,000 images already! Quite a lot to pick from. </p>
<p>Originally, I wanted to use an <em>off-the-shelf</em> solution. I found <a href="http://web.me.com/knarf/MacOSaiX/Download.html">MacOSaiX</a>, <a href="http://www.mazaika.com/mac/">Mazaika</a> and <a href="http://osxdaily.com/2007/02/02/easily-create-photo-mosaics-with-mozodojo/">Mozodojo</a>. The image below is created with Mazaika.</p>
<div class="clearfix"></div>

<p><img alt="Mazaika first attempt" src="http://farm8.staticflickr.com/7018/6558676823_9357ac2381.jpg" />
The problem with all of these is they are limited to certain sizes, despite giving good results. I wanted this to be A0 at 300DPI when printed. The problem of course, is that the image sizes are huge. Most programs just can't cope with it. Mazaika is limited in how many you can use unless you buy it (and its too expensive for what it is) and the others can't cope. So, in the end, I decided to write my own.</p>
<p>Using <em>OpenCV</em> I came up with two programs that you can <a href="https://github.com/OniDaito/PhotoMosaic">get from my github page</a>. The first goes through the set of images and creates a text file of average RGB values. The second performs the matching based on this database. OpenCV is used throughout to process the images. The result was a program that took a while to run, but wouldn't crash.</p>
<div class="clearfix"></div>

<p><img alt="first attempt" src="http://farm8.staticflickr.com/7146/6653456325_2dec97ee53.jpg" /></p>
<p>You can see that although it has worked, it's not brilliant. It matches well but I noticed that some areas were just too similar. I adjusted with a small amount of random jitter in the source colour.</p>
<p>After looking around the web, I finally found <a href="http://en.wikipedia.org/wiki/OpenMP">OpenMP</a> which is a lovely concept, baked right into GCC. It allows you to take control of many cores on your machine, and create threads easily.</p>
<pre><code>pragma omp parallel for
</code></pre>
<p>This one line basically sped up one of the steps by a factor of 7. Essentially, this task, without local neighbourhood refinement, is all parallel and so, OpenMP was a wonderful find and a free win. Great! </p>
<p>There is more to be done for sure - this sort of large scale processing could be useful for video, or maybe transformed into Scala or similar for parallel processing over many machines?</p>
      </div>

      <div class="col-md-3">
        <ul class="list-unstyled">
          
          <li><a href="/posts/2010-03-13-iphone-rfid-reader.html">iPhone RFID Reader</a></li>
          
          <li><a href="/posts/2010-06-08-spycam-timelapse-part1.html">Spycam Timelapse</a></li>
          
          <li><a href="/posts/2010-09-12-touchtable-dj-decks.html">TouchTable DJ Decks</a></li>
          
          <li><a href="/posts/2010-09-19-how-leaky-is-your-country.html">How Leaky is your Country?</a></li>
          
          <li><a href="/posts/2011-02-20-motorcycle-computer.html">Motorcycle Computer</a></li>
          
          <li><a href="/posts/2011-06-08-iPhone-Macro-Lens.html">iPhone Macro Lens Hack</a></li>
          
          <li><a href="/posts/2011-07-20-USB-Eartunnel.html">USB Eartunnel</a></li>
          
          <li><a href="/posts/2011-10-05-Defeating-Firewalls.html">Defeating Firewalls</a></li>
          
          <li><a href="/posts/2011-11-09-Smiling-Film-Student-Geekery.html">Smiling-Film-Student-Geekery</a></li>
          
          <li><a href="/posts/2012-02-3-Phantom-Limb.html">Phantom Limb Pain</a></li>
          
          <li><a href="/posts/2012-03-10-Spying.html">Spying and starting services with OSX</a></li>
          
          <li><a href="/posts/2013-04-28-Hackspace-Burger-Part1.html">Hackspace Burger Part 1</a></li>
          
          <li><a href="/posts/2013-05-10-Hackspace-Burger-Part2.html">Hackspace Burger Part 2</a></li>
          
          <li><a href="/posts/2013-05-21-Hackspace-burger-finale.html">Hackspace Burger Finale</a></li>
          
          <li><a href="/posts/2013-09-12-Doorbell.html">The EMF TilDA Badge Doorbell</a></li>
          
          <li><a href="/posts/2013-09-30-Necklace.html">LED Pendant</a></li>
          
          <li><a href="/posts/2014-09-06-900-Pixel-Screen.html">900 RGB LED Screen</a></li>
          
          <li><a href="/posts/2014-09-06-Nook-Patient-Report-Forms.html">Nook Patient Report Forms</a></li>
          
          <li><a href="/posts/2010-07-19-apache-git-and-mediawiki-to-manage-design-and-projects.html">Apache, GIT and Mediawiki to manage design and projects</a></li>
          
          <li><a href="/posts/2010-10-15-british-library-tweet-o-meter.html">British Library Tweet-o-meter</a></li>
          
          <li><a href="/posts/2011-03-25-quartz-composer-programming.html">Quartz Composer Programming</a></li>
          
          <li><a href="/posts/2011-04-23-quad-warp-dual-head.html">Quad Warp, Dual Head</a></li>
          
          <li><a href="/posts/2011-04-25-opengl-bottlenecks.html">OpenGL Bottlenecks</a></li>
          
          <li><a href="/posts/2011-08-04-Box2D-and-Puppets.html">Box2D and Puppets</a></li>
          
          <li><a href="/posts/2011-08-31-Knightmare-Bash.html">Knightmare Bash</a></li>
          
          <li><a href="/posts/2011-09-25-Node-and-Mongo.html">Node and Mongo</a></li>
          
          <li><a href="/posts/2011-11-02-Mongo-Fun.html">MongoDB Fun with Cinder</a></li>
          
          <li><a href="/posts/2015-06-05-QMUL.html">Scientific Programming at Queen Mary</a></li>
          
          <li><a href="/posts/2015-07-06-r2ks.html">R2kS - A Novel Measure for Comparing Gene Expression Based on Ranked Gene Lists</a></li>
          
          <li><a href="/posts/2015-07-16-daresbury.html">High Performance Computing at Daresbury</a></li>
          
          <li><a href="/posts/2010-07-12-first-ever-installation-success.html">First Ever Installation Success</a></li>
          
          <li><a href="/posts/2011-08-21-Freelance.html">A Digital Ronin - My year freelancing</a></li>
          
          <li><a href="/posts/2011-09-09-Forefist-punch.html">Forefist Punch</a></li>
          
          <li><a href="/posts/2011-10-14-Late-Night-Coding.html">Late Night Coding</a></li>
          
          <li><a href="/posts/2011-12-28-Lion-and-Linux-Together.html">Linux and Lion together at last (almost)</a></li>
          
          <li><a href="/posts/2012-03-21-Resonate.html">Resonate Festival</a></li>
          
          <li><a href="/posts/2012-04-02-New-Lab.html">New Lab</a></li>
          
          <li><a href="/posts/2012-04-27-BSides.html">BSides London</a></li>
          
          <li><a href="/posts/2012-06-05-Curator-Coin.html">The Curator's Coin</a></li>
          
          <li><a href="/posts/2012-06-15-Modern-Opengl.html">Modern OpenGL</a></li>
          
          <li><a href="/posts/2012-07-25-Graphics-Hackspace.html">Graphics Hackspace</a></li>
          
          <li><a href="/posts/2012-10-16-Raspberry-Pi.html">The Obligatory RaspberryPi Post</a></li>
          
          <li><a href="/posts/2012-11-05-Leaving-Google.html">Leaving Google</a></li>
          
          <li><a href="/posts/2012-12-21-edX.html">edX</a></li>
          
          <li><a href="/posts/2013-01-09-Computer-History.html">Computing History Records and Preservation</a></li>
          
          <li><a href="/posts/2015-05-19-Moving-On.html">So long business, and thanks for all the pixels.</a></li>
          
          <li><a href="/posts/2015-06-17-new-server.html">Running your own server, on a real box!</a></li>
          
          <li><a href="/posts/2015-07-30-social-media.html">We need to talk about Social Media</a></li>
          
        </ul>
      </div>


    </div>


    <footer>

      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h3>Ghost in the CSh</h3>
            <p>© Benjamin J. Blundell 2015 - <a style="color: white" title="Share &amp; Enjoy — CC-BY" href="https://creativecommons.org/licenses/by/3.0/">CC-BY</a> <a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></p>

          </div>
          <div class="col-md-4">
            <h3>Other places</h3>
            <p class="places-icons">
              <a href="https://github.com/OniDaito" title="GitHub"><i class="fa fa-github"></i></a>
              <a href="http://stackoverflow.com/users/104324/oni" title="Stack-Overflow"><i class="fa fa-stack-overflow"></i></a>
              <a href="https://www.flickr.com/photos/section9/" title="Flickr"><i class="fa fa-flickr"></i></a>
              <a href="https://www.youtube.com/user/onidaito/videos" title="Youtube"><i class="fa fa-youtube"></i></a>
              <a href="https://vimeo.com/user1678273/videos" title="Vimeo"><i class="fa fa-vimeo-square"></i></a>
            </p>
          </div>
          <div class="col-md-4">
            <h3>Contact</h3>
            <p class="places-icons">
             <a href="http://www.twitter.com/secti0n9" title="Twitter"><i class="fa fa-twitter"></i></a>
             <a href="mailto:ben@section9.co.uk" title="Email"><i class="fa fa-envelope-square"></i></a>
             <a href="https://uk.linkedin.com/in/section9" title="LinkedIn"><i class="fa fa-linkedin"></i></a>
             <a href="https://plus.google.com/u/0/+BenjaminBlundell/posts" title="Google Plus"><i class="fa fa-google-plus"></i></a>
             <a href="/key.html" title="GPG Key"><i class="fa fa-lock"></i></a>
           </p>
         </div>
       </div>


     </footer>
   </div>


  <script type="text/javascript">
    $(window).load(function(){

    // Process all images in the post for  left / right align
    var images = $("#content img");
    for(var i = 0; i < images.length; i++) {
      if (i % 2 == 0){
        $(images[i]).addClass("img-responsive img-thumbnail pull-left");
      } else {
        $(images[i]).addClass("img-responsive img-thumbnail pull-right");
      }
    }
  });
  </script>

  </body>
</html>

