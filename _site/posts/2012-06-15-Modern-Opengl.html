<!DOCTYPE html>
<!--
                      __  .__              ________ 
  ______ ____   _____/  |_|__| ____   ____/   __   \
 /  ___// __ \_/ ___\   __\  |/  _ \ /    \____    /
 \___ \\  ___/\  \___|  | |  (  <_> )   |  \ /    / 
/____  >\___  >\___  >__| |__|\____/|___|  //____/ .co.uk 
     \/     \/     \/                    \/        
   -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb" class="skrollr skrollr-desktop">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Modern OpenGL</title>
    <meta name="author" content="Benjamin Blundell" />
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Section9 ATOM Feed">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/css/s9.css" rel="stylesheet" media="screen">
    <link href="/css/font-awesome.min.css" rel="stylesheet" media="screen">


    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/s9-144.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/s9-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/s9-72.png">
    <link rel="apple-touch-icon-precomposed" href="/images/s9-57.png">
    <link rel="shortcut icon" href="/images/favicon.ico">

    <!-- META DATA - Need to Check and Update -->
    <meta name="google-site-verification" content="Ew7bGq_-B5Djz3nNvxYt6abpW2fUBOU-rFKrlvIQwiU" /> 

    <!-- General metadata -->
    <meta name="generator" content="" />
    <meta name="robots" content="index,follow" />
    <meta name="revisit-after" content="2 days" />
    <meta name="Author-Template" content="" />
    <meta name="Author" content="Benjamin Blundell" />
    <meta name="Publisher" content="Benjamin Blundell" />
    <meta name="Publisher-Email" content="ben@section9.co.uk" />
    <meta name="Coverage" content="UK" /> 

    <!-- Dublin Core Metadata -->
    <meta name="DC.creator" lang="en" content="Benjamin Blundell" />
    <meta name="DC.date.created" lang="en" content="" />
    <meta name="DC.format" lang="en" content="text/html" />
    <meta name="DC.language" content="en" />
    <meta name="DC.publisher" lang="en" content="Benjamin Blundell" />
    <meta name="DC.rights.copyright" lang="en" content="Benjamin Blundell" />
    <meta name="DC.coverage" lang="en" content="" />
    <meta name="DC.identifier" content="" />    

    <!-- eGMS Metadata -->
    <meta name="eGMS.status" lang="en" content="V1.0 Public Consumption" />

    <meta name="Keywords" content="opengl, webgl, coffeescript, git, hpc, kinect, opengl, cinder,openframeworks, cpp, c++, programming, graphics, art, design, code" />
    <meta name="Description" content="Benjamin Blundell, section9 dot co dot uk, the home of Benjamin Blundell. I make things with computers"/>
    <meta name="DC.title" lang="en" content="section9 dot co dot uk - Benjamin Blundell" />
    <meta name="DC.description" lang="en" content="" />
    <meta name="DC.subject" lang="en" content="" /> 

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/skrollr.min.js"></script>


  </head>

  <body>

    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <img class="navbar-brand-image" src="/images/s9_tiny.png" alt="section9 logo" />

          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/index.html">Benjamin J. Blundell</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li ><a href="/index.html">Home</a></li>
            <li ><a href="/blog.html">Blog</a></li>
            

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">Professional Work <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-12-21-Utopia.html">UTOPIA Bio-informatics Toolkit</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-12-12-Bullseye.html">Bullseye's playground for Target and Psyop</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-09-26-Echo-Forms-Live-Gig.html">Echoforms at Lexus NX Launch</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-09-06-900-Pixel-Screen.html">900 RGB LED Screen</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-07-28-Kaleidoscope.html">Kaleidoscope for Lexus</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2014-05-28-Equatorie.html">The Equatorie</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2014-02-13-Phantom-Limb-Oculus.html">Oculus Rift, meet Phantom Limb Therapy</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-08-06-Photorealistic-Hands.html">Photo-realistic hands</a></li>
                
                
                
                
                
                
                <li><a href="/posts/2013-07-12-BurberryKisses.html">Burberry Kisses, with Google and Grow Interactive</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-04-08-Museum-of-Rural-Life.html">Museum of Rural Life Smart Audio Guide</a></li>
                
                
                
                
                
                
                
                
                <li><a href="/posts/2013-02-18-BritishMuseumCoins.html">Coin Detection at the British Museum</a></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/posts/2012-11-19-The-Carp-and-the-Seagull.html">The Carp and the Seagull</a></li>
                
                
                <li class="divider"></li>
                <li><a href="/work.html">...and more!</a></li>

              </ul>
            </li>

            <li class="dropdown">
              <a href="/work.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">Fun Experiments <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">



                <li><a href="http://archive.section9.co.uk/transsib">Transsiberian Slitscan</a></li>
                <li><a href="http://archive.section9.co.uk/asteroids">Asteroids</a></li>
                <li><a href="http://echoforms.section9.co.uk/">EchoForms</a></li>
                <li><a href="http://archive.section9.co.uk/amiga/">Amiga Bouncing Ball</a></li>


              </ul>
            </li>

            <li ><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="jumbotron">
      <div class="container">
        <h2>Modern OpenGL</h2>
        <h3>15-06-2012</h3>
        <p>Some thoughts and code on modern OpenGL</p>
      </div>
    </div>

    <div class ="container" id="content">
      <div class="col-md-9">

        
<p>I've spent the last couple of weeks working on some code for The University of Leeds. Rather than actual research, this time has been spent on learning and adapting my code to be more compliant with OpenGL. I've done away with OpenFrameworks. It's now a mixture of <a href="http://pointclouds.org/">PCL</a>, <a href="opencv.willowgarage.com">OpenCV</a>, <a href="http://www.boost.org/">Boost</a>, <a href="http://glm.g-truc.net/">GLM</a> and <a href="http://qt.nokia.com/products/">QT</a>. I'm not so happy about the last one but it works at least. I've effectively, almost recreated Cinder under Linux (well, kind of).</p>
<p>OpenGL 4.2 is a little different from the OpenGL I learnt at Manchester - quite so. Gone are calls to <em>glBegin</em> and similar. Everything is handled with buffers, shaders and Vertex Array Objects. In addition, geometry shaders become more important. All the calls to push and pop matrices are gone too. In addition, we need to control all our views manually; no more <em>gluLookAt</em> or similar. But where to begin?</p>
<p>Firstly, we need a way to create a context. A context is essentially a setup or agreement with the underlying windowing system. For example, we kmight want a window with double buffering, alpha blending, full-screen anti-aliasing. There are a few ways of doing this. I've found that <a href="http://freeglut.sourceforge.net/">FreeGlut</a>, <a href="http://www.glfw.org/">GLFW</a> and <a href="http://qt.nokia.com/products/">QT</a> are probably the best. The sad thing is, we are still relying on GLUT in libraries such as <a href="http://www.openframeworks.cc/">OpenFrameworks</a>. <a href="http://libcinder.org/">Cinder</a> uses native extensions which is another good option. Under Linux however, things are trickier as the wxWidgets is quite old. OSX certainly has the prettiest native extensions but we can create quite nice things with the above. </p>
<p>The problem with most of these libraries is the lack of a decent GUI. QT has been slammed for being old and bloaty. OpenFrameworks has some fairly good GUIs such as <a href="https://github.com/rezaali/ofxUI">ofxUI</a>. Cinder has the <a href="http://www.antisphere.com/Wiki/tools:anttweakbar">AntTweakBar</a>. Some of these have problems with OpenGL 3.3 and above though. There is a nice heavyweight, middleware library called <a href="http://librocket.com/">Rocket</a> that looks interesting.</p>
<p>So what do we need to do to get a context and draw our triangles? Once we have the context, we need to load the extensions and map these to the libraries in the disk. If we dont do this, all our OpenGL fancy functions will map to NULL. So, we need a library that loads things for us. Fortunately we have <a href="http://glew.sourceforge.net/">GLEW</a>.</p>
<pre><code>glewExperimental = TRUE;
GLenum err=glewInit();
if(err!=GLEW_OK) {
    //Problem: glewInit failed
    cout &lt;&lt; "GLEWInit failed" &lt;&lt; endl;
}
</code></pre>
<p>This bit of code is really handy and we can't do much without it. At this point we can start our update and drawing loops. Its worth remembering that OpenGL is not thread safe; it's a state machine and the state is tied into the execution thread so make sure all your OpenGL calls are on the same thread.</p>
<p>Now we have all our extensions, we need to create what is known as a <a href="http://en.wikipedia.org/wiki/Vertex_Buffer_Object">Vertex Buffer</a> Object or VBO. This is a buffer that is created in main memory and then uploaded on to our graphics card. Our shaders are bound to the context and the buffer is sent through the shader and our triangles appear. A VBO looks a little like this:</p>
<pre><code>vbo = new GLuint[s];
glGenBuffers(s,vbo);
glBindBuffer(GL_ARRAY_BUFFER, mVID);
glBufferData(GL_ARRAY_BUFFER,
    mVertices.size() * sizeof(GLfloat), 
    &amp;mVertices[0], GL_DYNAMIC_DRAW);
</code></pre>
<p>So we create a certain number of buffers. We then bind the buffer and then provide it with some data. In this case, mVertices is a std::vector<float> .</p>
<p>Now, we can add other things here, such as indices, texture co-ordinates, normals, colours and many other things. We can bundle these all together in a saved state called a <a href="http://www.opengl.org/wiki/Vertex_Array_Object">Vertex Array Object</a>. This is a handy piece of syntax that essentially allows us to recall all the buffer settings. </p>
<p>No, we have a triangle specified but we also need a shader. In fact we need at least 2 and maybe 3. We need a <a href="http://en.wikipedia.org/wiki/ShaderPixel_shaders">Fragment Shader</a>, a <a href="http://en.wikipedia.org/wiki/ShaderVertex_shaders">Vertex Shader</a> and we can also add a <a href="http://en.wikipedia.org/wiki/ShaderGeometry_shaders">Geometry Shader</a> as well should we wish. Creating a shader is an interesting topic and there are many cool effects we can do. As my graphics card supports OpenGL4.2, I can write a simple shader like this:</p>
<pre><code>version 420 compatibility
out vec4 vertex_position;
out vec2 texCoord;

layout (location = 0) in vec3 attribVertPosition; // 1 is the indicies
layout (location = 2) in vec2 attribVertTexCoord;

uniform mat4 mMVPMatrix;

void main() {            
    vertex_position = mMVPMatrix *
        vec4(attribVertPosition,1.0);
    gl_Position = vertex_position;
    texCoord = attribVertTexCoord;
}
</code></pre>
<p>This is the vertex shader and is probably the more complicated section in this simple example, because it has a <em>layout</em> directive. This basically states that the first buffer to be bound contains positions. The second buffer to be bound isn't used and the third buffer to be bound contains the texture co-ordinates. These indexes reflect the order and position of the vertex buffer objects we bound before.</p>
<p>Our fragment shader comes next:</p>
<pre><code>version 420 compatibility
in vec4 vertex_position;
in vec2 texCoord;
uniform sampler2DRect mBaseTex;

void main() {
    gl_FragColor = texture(mBaseTex,texCoord);
}
</code></pre>
<p>This simple example just outputs the texel colour for that fragment. Simple enough.</p>
<p>So, we have a triangle or similar on our screen. How now do we deal with transformations? Remember <em>glRotatef</em> and <em>glTranslatef</em> ? These functions are part of what is called <em>Immediate Mode Rendering</em> . This technique is now old, inefficient and only supported for legacy apps. The reason is largely due to hardware. Its much better to perform graphics processing on the GPU. Take the iPhone and OpenGLES2 for instances. We simply don't have immediate mode rendering anymore. </p>
<p>We need a second library to work with our matrices and similar. I've used OpenCV in the past but it doesn't have the most intuitive interface sadly. Fortunately, there is an amazing library called <a href="http://glm.g-truc.net/">GLM</a> which I HIGHLY recommend everyone use. It's a great piece of kit. It is a header only library (which I love) and has all the matrix functions you could wish for. For example, here is a simple camera, written in GLM</p>
<pre><code>mObj-&gt;mHoriz += static_cast&lt;float_t&gt;(dx) * (sSense/static_cast&lt;float_t&gt;(dt));
mObj-&gt;mVert  += static_cast&lt;float_t&gt;(dy) * (sSense/static_cast&lt;float_t&gt;(dt));

glm::quat q_rotate;
glm::vec3 direction = glm::vec3(0,0,200.0);
glm::vec3 up = glm::vec3(0,1,0);

q_rotate = glm::rotate( q_rotate, mObj-&gt;mHoriz, glm::vec3( 0, 1, 0 ) );
q_rotate = glm::rotate( q_rotate, mObj-&gt;mVert, glm::vec3( 1, 0, 0 ) );

direction = q_rotate * direction;
up = q_rotate * up;

mObj-&gt;mViewMatrix = glm::lookAt(direction, glm::vec3(0,0,0),up );
</code></pre>
<p>Quite simple eh? mViewMatrix can now be sent to our vertex shader. If you take a closer look at our shader you can see <em>mMVPMatrix</em>. This matrix multiples all the vertices and we end up with our lovely scene.</p>
<p>This is quite a brief introduction really. I'm still re-learning all of this. I find it quite useful to get my head around the various shaders and buffers because this is exactly how WebGL works (as that is basically OpenGLES2). More to come!</p>
      </div>

      <div class="col-md-3">
        <ul class="list-unstyled">
          
          <li><a href="/posts/2010-02-01-decode09-recode-entry.html">Decode09 - Recode Entry</a></li>
          
          <li><a href="/posts/2010-02-28-nin-only-tribute.html">NIN Only Tribute</a></li>
          
          <li><a href="/posts/2010-09-12-touchtable-dj-decks.html">TouchTable DJ Decks</a></li>
          
          <li><a href="/posts/2010-10-06-structured-light.html">Structured Light</a></li>
          
          <li><a href="/posts/2010-12-21-cinder-shadow-volumes.html">Cinder Shadow Volumes</a></li>
          
          <li><a href="/posts/2011-01-26-projection-mapping.html">Projection Mapping</a></li>
          
          <li><a href="/posts/2011-02-04-cinder-skinning.html">Cinder Skinning</a></li>
          
          <li><a href="/posts/2011-02-25-kinect-skeleton-for-skinning.html">Kinect Skeleton for Skinning</a></li>
          
          <li><a href="/posts/2011-03-15-depth-of-field-in-cinder.html">Depth of Field in Cinder</a></li>
          
          <li><a href="/posts/2011-03-18-screen-space-ambient-occlusion-again.html">Screen Space Ambient Occlusion, again</a></li>
          
          <li><a href="/posts/2011-04-13-the-woes-of-soft-shadows.html">The Woes of Soft Shadows</a></li>
          
          <li><a href="/posts/2011-04-23-quad-warp-dual-head.html">Quad Warp, Dual Head</a></li>
          
          <li><a href="/posts/2011-04-25-opengl-bottlenecks.html">OpenGL Bottlenecks</a></li>
          
          <li><a href="/posts/2011-05-08-canned-kinect.html">Canned Kinect</a></li>
          
          <li><a href="/posts/2011-05-24-My-First-Big-Thing-Deutsche-Bank.html">Deutsche Bank Installation</a></li>
          
          <li><a href="/posts/2011-06-15-only.html">Only Installation at the Lowry</a></li>
          
          <li><a href="/posts/2011-11-02-Mongo-Fun.html">MongoDB Fun with Cinder</a></li>
          
          <li><a href="/posts/2011-12-05-Lowry-to-Life.html">Lowry to Life</a></li>
          
          <li><a href="/posts/2012-02-3-Phantom-Limb.html">Phantom Limb Pain</a></li>
          
          <li><a href="/posts/2012-07-02-User-Interfaces-in-OpenGL.html">User Interfaces in OpenGL</a></li>
          
          <li><a href="/posts/2012-08-01-Touch-Wall.html">Building a Vertical Touch Wall</a></li>
          
          <li><a href="/posts/2012-08-17-Organ-Reconstruction.html">3D Organ Reconstruction</a></li>
          
          <li><a href="/posts/2012-09-04-Touch-Wall.html">A Touch Wall under the M1 Motorway</a></li>
          
          <li><a href="/posts/2012-12-13-Painless-Science.html">Phantom Limb at the Science Museum</a></li>
          
          <li><a href="/posts/2013-11-25-Phantom-Limb-01.html">Phantom Limb Dev Diary Part 1</a></li>
          
          <li><a href="/posts/2014-01-12-Phantom-Limb-02.html">Phantom Limb Dev Diary Part 2</a></li>
          
          <li><a href="/posts/2014-01-28-Phantom-Limb-03.html">Phantom Limb Dev Diary Part 3</a></li>
          
          <li><a href="/posts/2014-02-05-Phantom-Limb-04.html">Phantom Limb Dev Diary Part 4</a></li>
          
          <li><a href="/posts/2014-02-13-Phantom-Limb-Oculus.html">Oculus Rift, meet Phantom Limb Therapy</a></li>
          
          <li><a href="/posts/2010-07-12-first-ever-installation-success.html">First Ever Installation Success</a></li>
          
          <li><a href="/posts/2011-08-21-Freelance.html">A Digital Ronin - My year freelancing</a></li>
          
          <li><a href="/posts/2011-08-31-Knightmare-Bash.html">Knightmare Bash</a></li>
          
          <li><a href="/posts/2011-09-09-Forefist-punch.html">Forefist Punch</a></li>
          
          <li><a href="/posts/2011-10-14-Late-Night-Coding.html">Late Night Coding</a></li>
          
          <li><a href="/posts/2011-12-28-Lion-and-Linux-Together.html">Linux and Lion together at last (almost)</a></li>
          
          <li><a href="/posts/2012-01-13-Mosaic.html">Mosaic</a></li>
          
          <li><a href="/posts/2012-03-21-Resonate.html">Resonate Festival</a></li>
          
          <li><a href="/posts/2012-04-02-New-Lab.html">New Lab</a></li>
          
          <li><a href="/posts/2012-04-27-BSides.html">BSides London</a></li>
          
          <li><a href="/posts/2012-06-05-Curator-Coin.html">The Curator's Coin</a></li>
          
          <li><a href="/posts/2012-07-25-Graphics-Hackspace.html">Graphics Hackspace</a></li>
          
          <li><a href="/posts/2012-10-16-Raspberry-Pi.html">The Obligatory RaspberryPi Post</a></li>
          
          <li><a href="/posts/2012-11-05-Leaving-Google.html">Leaving Google</a></li>
          
          <li><a href="/posts/2012-12-21-edX.html">edX</a></li>
          
          <li><a href="/posts/2013-01-09-Computer-History.html">Computing History Records and Preservation</a></li>
          
          <li><a href="/posts/2015-05-19-Moving-On.html">So long business, and thanks for all the pixels.</a></li>
          
          <li><a href="/posts/2015-06-05-QMUL.html">Scientific Programming at Queen Mary</a></li>
          
          <li><a href="/posts/2015-06-17-new-server.html">Running your own server, on a real box!</a></li>
          
          <li><a href="/posts/2015-07-30-social-media.html">We need to talk about Social Media</a></li>
          
          <li><a href="/posts/2015-08-16-cccamp.html">CCCamp2015</a></li>
          
        </ul>
      </div>


    </div>


    <footer>

      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h3>Ghost in the CSh</h3>
            <p>© Benjamin J. Blundell 2015 - <a style="color: white" title="Share &amp; Enjoy — CC-BY" href="https://creativecommons.org/licenses/by/3.0/">CC-BY</a> <a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></p>

          </div>
          <div class="col-md-4">
            <h3>Other places</h3>
            <p class="places-icons">
              <a href="https://github.com/OniDaito" title="GitHub"><i class="fa fa-github"></i></a>
              <a href="http://stackoverflow.com/users/104324/oni" title="Stack-Overflow"><i class="fa fa-stack-overflow"></i></a>
              <a href="https://www.flickr.com/photos/section9/" title="Flickr"><i class="fa fa-flickr"></i></a>
              <a href="https://www.youtube.com/user/onidaito/videos" title="Youtube"><i class="fa fa-youtube"></i></a>
              <a href="https://vimeo.com/user1678273/videos" title="Vimeo"><i class="fa fa-vimeo-square"></i></a>
            </p>
          </div>
          <div class="col-md-4">
            <h3>Contact</h3>
            <p class="places-icons">
             <a href="http://www.twitter.com/secti0n9" title="Twitter"><i class="fa fa-twitter"></i></a>
             <a href="mailto:ben@section9.co.uk" title="Email"><i class="fa fa-envelope-square"></i></a>
             <a href="https://uk.linkedin.com/in/section9" title="LinkedIn"><i class="fa fa-linkedin"></i></a>
             <a href="https://plus.google.com/u/0/+BenjaminBlundell/posts" title="Google Plus"><i class="fa fa-google-plus"></i></a>
             <a href="/key.html" title="GPG Key"><i class="fa fa-lock"></i></a>
           </p>
         </div>
       </div>


     </footer>
   </div>


  <script type="text/javascript">
    $(window).load(function(){

    // Process all images in the post for  left / right align
    var images = $("#content img");
    for(var i = 0; i < images.length; i++) {
      if (i % 2 == 0){
        $(images[i]).addClass("img-responsive img-thumbnail pull-left");
      } else {
        $(images[i]).addClass("img-responsive img-thumbnail pull-right");
      }
    }
  });
  </script>

  </body>
</html>

